packages:
  yum:
    python27: []
    python27-devel: []
    make: []
    httpd-devel: []

commands:
  installmodwsgi27:
    command: '[ -f mod_wsgi-3.4.tar.gz ] && echo "mod_wsgi-3.4 is already installed" || { wget http://modwsgi.googlecode.com/files/mod_wsgi-3.4.tar.gz; tar xzvf mod_wsgi-3.4.tar.gz; cd mod_wsgi-3.4; ./configure --with-python=python27; make; make install; } | iconv -f utf-8 -t us-ascii//TRANSLIT'

  usepython27:
    command: grep "python2.7" 03deploy.py || sed -i 's/--distribute/--python=python2.7 &/' 03deploy.py
    cwd: /opt/elasticbeanstalk/hooks/appdeploy/pre

  fix_apache_template_01:
    command: grep "WSGIPythonHome /opt/python/run/venv" config.py || sed -i 's,WSGIPythonHome .*,WSGIPythonHome /opt/python/run/venv,' config.py
    cwd: /opt/elasticbeanstalk/hooks

  fix_apache_template_02:
    command: grep "python2.7/site-packages" config.py || sed -i 's/python2.6/python2.7/' config.py
    cwd: /opt/elasticbeanstalk/hooks

  fix_apache_template_03:
    command: grep "WSGIPassAuthorization On" config.py || sed -i '/WSGIRestrictEmbedded On/ aWSGIPassAuthorization On' config.py
    cwd: /opt/elasticbeanstalk/hooks
